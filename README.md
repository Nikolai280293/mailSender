# Сервер для отправки сертификатов

Этот проект позволяет отправлять сертификаты через электронную почту с помощью `Node.js` и `Nodemailer`. Список email-адресов загружается из `CSV-файла`, и для каждого адреса отправляется письмо с прикрепленным сертификатом.

## Установка

### 1. Установка Node.js

Для начала работы с проектом вам нужно установить `Node.js`. Если он еще не установлен, скачайте и установите его с официального сайта: [https://nodejs.org](https://nodejs.org).

### 2. Скачайте проект

Скачайте или клонируйте этот репозиторий на свой компьютер.

### 3. Установка зависимостей

Перейдите в директорию проекта и установите все необходимые зависимости с помощью `npm`:

- Откройте терминал в папке проекта
- Выполните команду:

    ```bash
    npm install
    ```

### 4. Настройка SMTP

- Убедитесь, что вы настроили почтовый транспорт в коде. В текущем примере используется SMTP-сервер Яндекса:

    ```js
    const transporter = nodemailer.createTransport({
        host: "smtp.yandex.ru",
        port: 465,
        secureConnection: true,
        auth: {
            user: "name",
            pass: "password",
        },
    });
    ```

- Измените значения `user` и `pass` на актуальные для вашего почтового ящика. Для других почтовых сервисов вам нужно будет обновить эти параметры в зависимости от их настроек.

### 5. Подготовка CSV файла

- Заполните `emails.csv` в корне проекта. Файл должен содержать столбец `email` с адресами для отправки. Пример:

    ```csv
    email
    example1@mail.com
    example2@mail.com
    example3@mail.com
    ```

### 6. Размещение сертификатов

- В папке `resources` разместите PDF-файлы с сертификатами, которые будут прикреплены к письмам. Каждый файл должен быть назван в формате `Сертификат_1.pdf`, `Сертификат_2.pdf` 
и т.д., или измените код для другого формата именования файлов.

- **Не забудьте удалить файл `.gitkeep` из папки `resources`**, если он там есть. Этот файл используется для сохранения пустых папок в Git и не требуется для работы проекта.

### 7. Запуск

- После настройки всего необходимого запустите скрипт командой:

    ```bash
    node app.js
    ```

- Скрипт будет отправлять письма на указанные адреса с прикрепленными сертификатами, а также записывать логи в файл `log.txt`.

### 8. Описание работы

- Скрипт читает `CSV-файл` с email-адресами.
- Для каждого адреса ищет соответствующий файл сертификата в папке `resources`.
- Если файл найден, он прикрепляется к письму.
- Письмо отправляется с использованием SMTP-сервера (по умолчанию используется Яндекс).
- В письме содержится HTML-контент и текстовое описание.
- Логи о отправке писем и ошибках записываются в файл `log.txt`.

### 9. Логирование

- Логи записываются в файл `log.txt` в корне проекта. Все ошибки и успешные отправки фиксируются с меткой времени.

### 10. Повторная попытка отправки

- Если письмо не удается отправить (например, из-за временной ошибки), скрипт будет пытаться отправить письмо повторно до 12 раз с увеличением задержки между попытками.

### 11. Структура проекта

- `emails.csv` — файл с email-адресами.
- `resources` — папка с сертификатами в формате PDF.
- `log.txt` — файл для логов.
- `app.js` — основной файл скрипта.

### 12. Возможные ошибки

- Ошибка при чтении CSV файла: Проверьте правильность формата CSV.
- Ошибка при отправке письма: Возможно, настройки SMTP требуют корректировки или есть проблемы с сетью.